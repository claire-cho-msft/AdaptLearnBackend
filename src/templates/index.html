<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>{{ title | default('IT Admins - Microsoft Teams deployment overview | Microsoft Learn') }}</title>
  <meta name="viewport" content="width=1024">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 0;
      background: #fff;
      color: #222;
      font-size: 16px;
      line-height: 1.6;
    }

    header {
      background: #fff;
      border-bottom: 1px solid #e5e5e5;
      padding: 0 0 0 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header .logo {
      padding: 10px 24px 10px 24px;
      display: flex;
      align-items: center;
    }

    header .logo img {
      height: 20px;
      margin-right: 10px;
    }

    header .nav-links {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 24px;
    }

    header .nav-links a {
      color: #222;
      text-decoration: none;
      font-size: 15px;
      padding: 0 10px;
      line-height: 56px;
      display: inline-block;
    }

    header .nav-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-right: 24px;
    }

    header .nav-actions button,
    header .nav-actions a {
      font-size: 13px;
      padding: 6px 14px;
      border: none;
      border-radius: 2px;
      margin-left: 2px;
      cursor: pointer;
      text-decoration: none;
      color: #fff;
      background: #0067b8;
      transition: background 0.2s;
    }

    header .nav-actions button:hover,
    header .nav-actions a:hover {
      background: #005a9e;
    }

    header .nav-actions a[style*="background:#e5e5e5"] {
      background: #e5e5e5 !important;
      color: #222 !important;
      font-weight: 500;
      border: none;
    }

    header .sign-in {
      color: #0067b8;
      background: none;
      border: none;
      padding: 6px 12px;
      font-size: 15px;
      cursor: pointer;
      margin-left: 4px;
      transition: color 0.2s;
    }

    header .sign-in:hover {
      text-decoration: underline;
      color: #004578;
    }

    .breadcrumbs {
      font-size: 14px;
      color: #555;
      margin: 0;
      padding: 24px 0 0 40px;
    }

    .breadcrumbs a {
      color: #0078d4;
      text-decoration: none;
    }

    .breadcrumbs span {
      margin: 0 6px;
      color: #888;
    }

    .container {
      display: flex;
      flex-direction: row;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px 24px 24px;
    }

    nav.sidebar {
      min-width: 220px;
      max-width: 220px;
      margin-right: 32px;
      padding-top: 10px;
      border-right: 1px solid #eee;
      font-size: 15px;
    }

    nav.sidebar h3 {
      font-size: 16px;
      margin-top: 10px;
      margin-bottom: 8px;
      padding-left: 12px;
      font-weight: 600;
      color: #333;
    }

    nav.sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    nav.sidebar li {
      margin: 1px 0;
    }

    nav.sidebar a {
      display: block;
      padding: 7px 16px;
      color: #222;
      text-decoration: none;
      border-radius: 3px;
      transition: background 0.1s;
    }

    nav.sidebar a[aria-current="page"] {
      background: #e3f2fd;
      color: #005a9e;
      font-weight: 600;
    }

    nav.sidebar a:hover {
      background: #f3f9fd;
    }

    .main-area {
      flex: 1;
      min-width: 0;
      max-width: 800px;
      padding-top: 18px;
    }

    .right-nav {
      min-width: 220px;
      max-width: 240px;
      margin-left: 32px;
      padding-top: 18px;
      font-size: 15px;
    }

    .right-nav .in-this-article {
      background: #f3f9fd;
      border-radius: 8px;
      padding: 16px 18px 10px 18px;
      margin-bottom: 24px;
    }

    .right-nav .in-this-article h4 {
      font-size: 15px;
      color: #333;
      margin: 0 0 10px 0;
      font-weight: 600;
    }

    .right-nav ul {
      list-style: none;
      padding: 0;
      margin: 0 0 0 0;
    }

    .right-nav li {
      margin: 0 0 8px 0;
    }

    .right-nav a {
      color: #0078d4;
      text-decoration: none;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 10px 0;
      color: #242424;
    }

    .meta {
      font-size: 14px;
      color: #666;
      margin-bottom: 18px;
    }

    .tip-box {
      background: #eaf6ed;
      border-left: 4px solid #73b563;
      border-radius: 5px;
      padding: 18px 22px 16px 22px;
      margin: 16px 0 24px 0;
      display: flex;
      gap: 14px;
      align-items: flex-start;
    }

    .tip-box .tip-icon {
      margin-top: 2px;
      color: #339933;
      font-size: 20px;
      flex-shrink: 0;
    }

    .tip-box .tip-content {
      flex: 1;
      font-size: 15px;
      color: #265e22;
    }

    .tip-box .tip-content a {
      color: #0b6a0b;
      text-decoration: underline;
    }

    /* Code block styling */
    .main-area .section-content pre {
      background: #f6f8fa;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      padding: 16px;
      margin: 16px 0;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.45;
      color: #24292e;
      white-space: pre;
    }

    .main-area .section-content pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
      color: inherit;
      white-space: pre;
    }

    .main-area .section-content code {
      background: #f6f8fa;
      border: 1px solid #e1e4e8;
      border-radius: 3px;
      padding: 0.2em 0.4em;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 85%;
      color: #e36209;
    }

    .main-area .para {
      margin-bottom: 16px;
      font-size: 16px;
    }

    .main-area a {
      color: #0078d4;
      text-decoration: underline;
    }

    .main-area .inline-green-link {
      color: #0b6a0b;
      font-weight: 500;
      text-decoration: underline;
    }

    .main-area .section {
      margin-top: 34px;
      margin-bottom: 24px;
      border-radius: 8px;
      border: 1px solid #e6e6e6;
      box-shadow: 0 1px 2px #eee;
      background: #f9f9f9;
      padding: 0 0 22px 0;
      position: relative;
    }

    .main-area .section-header {
      padding: 18px 24px 8px 24px;
      border-bottom: 1px solid #eaeaea;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .main-area .section-header h2 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      flex: 1;
      color: #222;
      /* Ensure no extra line height for alignment */
      line-height: 1.2;
      display: flex;
      align-items: center;
    }

    /* SLIDER SWITCH START */
    .switch {
      display: flex;
      align-items: center;
      height: 100%;
      position: relative;
    }

    .switch-slider {
      width: 90px;
      height: 32px;
      display: flex;
      align-items: center;
      position: relative;
      margin-left: 18px;
      /* Remove top margin, align with heading */
      margin-top: 0;
      margin-bottom: 0;
    }

    .slider-track {
      position: relative;
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      /* Remove top offset to vertically center */
      top: 0;
      display: flex;
      align-items: center;
    }

    .slider-dot {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      background: #fff;
      border: 2.5px solid #b3b3b3;
      border-radius: 50%;
      z-index: 2;
      transition: border 0.2s, background 0.2s;
      pointer-events: none;
    }

    .slider-dot.active,
    .slider-dot.selected {
      border-color: #0078d4;
      background: #e3f2fd;
    }

    .slider-dot:nth-child(1) {
      left: 0%;
    }

    .slider-dot:nth-child(2) {
      left: 50%;
    }

    .slider-dot:nth-child(3) {
      left: 100%;
    }

    .slider-thumb {
      position: absolute;
      top: 50%;
      /* We'll set left in JS to align its center with the dot */
      width: 26px;
      height: 26px;
      background: #0078d4;
      border-radius: 50%;
      box-shadow: 0 1px 4px #bbb;
      transition: left 0.2s;
      z-index: 3;
      border: 2.5px solid #fff;
      left: 0%;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    /* SLIDER SWITCH END */

    /* CONTENT ADAPTATION STYLES */
    .loading-spinner {
      text-align: center;
      padding: 20px;
      font-style: italic;
      color: #666;
      background: #f9f9f9;
      border-radius: 4px;
      margin: 10px 0;
    }

    .error-message {
      background: #ffebee;
      border: 1px solid #f44336;
      color: #c62828;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 14px;
    }

    .section-content {
      transition: opacity 0.3s ease;
    }

    .main-area .section-content {
      padding: 18px 24px 0 24px;
      font-size: 16px;
    }

    .main-area .section-content ul {
      padding-left: 24px;
      margin: 8px 0 8px 0;
    }

    .main-area .section-content ul li {
      margin: 6px 0;
    }

    .main-area .section-content ul li a {
      color: #0078d4;
      text-decoration: underline;
    }

    .main-area .section-content .note-block {
      background: #eaf6ed;
      border-left: 4px solid #73b563;
      border-radius: 5px;
      padding: 14px 18px;
      margin: 20px 0 14px 0;
      color: #265e22;
      font-size: 15px;
    }

    .main-area .section-content .note-block a {
      color: #0b6a0b;
      text-decoration: underline;
    }

    /* Video container styling */
    .main-area .section-content .video-container {
      margin: 20px 0;
      position: relative;
    }

    .main-area .section-content .video-container iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .main-area .section-content .video-container video {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Zone pivot styling */
    .main-area .section-content .zone-pivot-container {
      position: relative;
    }

    .main-area .section-content .zone-pivot {
      display: none;
    }

    .main-area .section-content .zone-pivot.active {
      display: block;
    }

    .zone-pivot-selector {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }

    .zone-pivot-selector button {
      padding: 6px 12px;
      border: 1px solid #dee2e6;
      background: #fff;
      color: #495057;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .zone-pivot-selector button.active {
      background: #0078d4;
      color: #fff;
      border-color: #0078d4;
    }

    .zone-pivot-selector button:hover:not(.active) {
      background: #e9ecef;
    }

    .main-area .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin: 18px 0 0 0;
      font-size: 14px;
      color: #888;
    }

    .main-area .pagination .page {
      padding: 1px 8px;
      border-radius: 3px;
      font-weight: 500;
      background: #f3f9fd;
      color: #0078d4;
      border: 1px solid #e0e0e0;
      margin: 0 2px;
      cursor: pointer;
    }

    .main-area .pagination .page.current {
      background: #e3f2fd;
      color: #222;
      border: 1px solid #b3d4fc;
    }

    .feedback-section {
      margin: 40px 0 0 0;
      padding: 24px 0 0 0;
      border-top: 1px solid #e5e5e5;
      font-size: 15px;
      color: #222;
    }

    .feedback-section .feedback-question {
      margin-bottom: 8px;
      font-size: 15px;
      font-weight: 500;
    }

    .feedback-section .feedback-buttons {
      display: inline-flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .feedback-section .feedback-buttons button {
      padding: 5px 22px;
      border: 1px solid #0078d4;
      background: #fff;
      color: #0078d4;
      border-radius: 3px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }

    .feedback-section .feedback-buttons button.selected,
    .feedback-section .feedback-buttons button:hover {
      background: #e3f2fd;
      color: #005a9e;
    }

    .feedback-section .feedback-link {
      display: block;
      color: #0078d4;
      margin-top: 10px;
      text-decoration: underline;
      font-size: 15px;
    }

    footer {
      border-top: 1px solid #e5e5e5;
      background: #fcfcfc;
      padding: 18px 24px 18px 24px;
      font-size: 13px;
      color: #555;
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      justify-content: space-between;
      align-items: center;
    }

    footer .footer-links {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    footer .footer-links a {
      color: #0078d4;
      text-decoration: none;
    }

    footer .footer-links a:hover {
      text-decoration: underline;
    }

    footer .footer-meta {
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    .footer-meta .theme-select,
    .footer-meta .privacy-choice {
      display: inline-block;
      margin-right: 14px;
    }

    .footer-meta select {
      font-size: 13px;
      padding: 2px 6px;
      border-radius: 2px;
    }

    @media (max-width: 1200px) {
      .container {
        flex-direction: column;
        max-width: 100vw;
        padding: 0 8px 24px 8px;
      }

      nav.sidebar,
      .right-nav {
        max-width: 100vw;
        min-width: 0;
        margin: 0;
        border: none;
      }

      .main-area {
        max-width: 100vw;
        padding-left: 0;
        padding-right: 0;
      }
    }

    @media (max-width: 800px) {

      header,
      footer {
        flex-direction: column;
        gap: 8px;
        padding: 8px 8px;
      }

      .container {
        padding: 0 2px 24px 2px;
      }
    }

    /* Adapted Content Styles */
    .beginner-content, .intermediate-content {
      background: #f8f9fa;
      border-left: 4px solid #007acc;
      border-radius: 6px;
      padding: 16px 20px;
      margin: 16px 0;
    }

    .beginner-content {
      border-left-color: #28a745;
    }

    .intermediate-content {
      border-left-color: #ffc107;
    }

    .helpful-context, .implementation-details, .workflow-context, .architecture-context, .technical-context {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 12px 16px;
      margin-top: 12px;
      font-size: 14px;
    }

    .helpful-context p, .implementation-details p, .workflow-context p, .architecture-context p, .technical-context p {
      margin: 8px 0;
    }

    .helpful-context p:first-child, .implementation-details p:first-child, .workflow-context p:first-child, .architecture-context p:first-child, .technical-context p:first-child {
      margin-top: 0;
    }

    .helpful-context p:last-child, .implementation-details p:last-child, .workflow-context p:last-child, .architecture-context p:last-child, .technical-context p:last-child {
      margin-bottom: 0;
    }

    .beginner-content h4, .intermediate-content h4 {
      color: #333;
      font-size: 16px;
      margin: 0 0 12px 0;
      font-weight: 600;
    }

    .beginner-content ul, .intermediate-content ul {
      margin: 8px 0;
      padding-left: 20px;
    }

    .beginner-content li, .intermediate-content li {
      margin-bottom: 6px;
      line-height: 1.5;
    }

    .beginner-content code, .intermediate-content code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
    }

  </style>
</head>

<body>
  <header>
    <div class="logo">
      <img src="https://learn.microsoft.com/favicon.ico" alt="Microsoft logo">
      <span style="font-size: 19px; font-weight: 600; color: #0078d4;">Learn</span>
    </div>
    <nav class="nav-links" aria-label="Main navigation">
      <a href="#">Discover</a>
      <a href="#">Product documentation</a>
      <a href="#">Development languages</a>
      <a href="#">Topics</a>
    </nav>
    <div class="nav-actions">
      <a href="#" style="background:#e5e5e5; color:#222; font-weight: 500; border: none;">Developer Portal</a>
      <a href="#" style="background:#2266e3;">Download Microsoft 365 Agents Toolkit</a>
      <button class="sign-in">Sign in</button>
    </div>
  </header>
  <div class="breadcrumbs">
    {% if breadcrumbs %}
    {% for crumb in breadcrumbs %}
    {% if crumb.url %}
    <a href="{{ crumb.url }}">{{ crumb.name }}</a>
    <span>/</span>
    {% else %}
    <span>{{ crumb.name }}</span>
    {% endif %}
    {% endfor %}
    {% endif %}
  </div>
  <div class="container">
    <nav class="sidebar" aria-label="Sidebar navigation">
      <div style="margin-bottom: 12px;">
        <input type="search" placeholder="Filter by title"
          style="width: 90%; padding: 5px 8px; border-radius: 3px; border: 1px solid #ddd; font-size: 15px;">
      </div>
      {% for section in sidebar_structure %}
      <h3>{{ section.title }}</h3>
      <ul>
        {% for link in section.links %}
        <li>
          <a href="{{ link.url }}" 
             {% set link_filename = link.url.split('/')[-1] + '.md' %}
             {% if current_page and current_page == link_filename %}aria-current="page"{% endif %}>
            {{ link.text }}
          </a>
        </li>
        {% endfor %}
      </ul>
      {% endfor %}
    </nav>
    <main class="main-area">
      <h1>{{ title | default('IT Admins - Microsoft Teams deployment overview') }}</h1>
      <div class="meta">{{ meta | default('10/28/2024 &nbsp;‚Ä¢&nbsp; Applies to: Microsoft Teams') | safe }}</div>
      {% if tip_content %}
      <div class="tip-box">
        <span class="tip-icon" title="Tip">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <circle cx="10" cy="10" r="10" fill="#73b563" /><text x="9" y="15" text-anchor="middle" fill="#fff"
              font-size="14" font-family="Segoe UI,Arial" font-weight="bold">i</text>
          </svg>
        </span>
        <div class="tip-content">
          {{ tip_content | safe }}
        </div>
      </div>
    
      {% endif %}
      {% if intro_paragraph %}
      <div class="para">
        {{ intro_paragraph | safe }}
      </div>
      {% endif %} 

      <!-- Dynamic Sections -->
      {% if sections %}
      {% for section in sections %}
      <section class="section" id="{{ section.id }}">
        <div class="section-header">
          <h2>{{ section.title }}</h2>
          <span class="switch">
            <div class="switch-slider" id="slider-{{ section.id }}" tabindex="0" aria-label="3-position slider" role="slider"
              aria-valuenow="3" aria-valuemin="1" aria-valuemax="3">
              <div class="slider-track">
                <div class="slider-dot"></div>
                <div class="slider-dot"></div>
                <div class="slider-dot active"></div>
                <div class="slider-thumb" style="left: 100%;"></div>
              </div>
            </div>
          </span>
        </div>
        <div class="section-content">
          {% for content_item in section.content %}
          {% if content_item.type == 'paragraph' %}
          <div class="para">{{ content_item.text | safe }}</div>
          {% elif content_item.type == 'list' %}
          <ul>
            {% for item in content_item.elements %}
            <li>{{ item | safe }}</li>
            {% endfor %}
          </ul>
          {% elif content_item.type == 'note' %}
          <div class="note-block">{{ content_item.text | safe }}</div>
          {% elif content_item.type == 'video' %}
          <div class="video-container">{{ content_item.html | safe }}</div>
          {% elif content_item.type == 'zone-pivot' %}
          <div class="zone-pivot-container" data-pivot="{{ content_item.pivot }}">
            {{ content_item.html | safe }}
          </div>
          {% endif %}
          {% endfor %}
        </div>
      </section>
      {% endfor %}
    
      {% endif %}
      <section class="feedback-section">
        <div class="feedback-question">Was this page helpful?</div>
        <div class="feedback-buttons">
          <button>Yes</button>
          <button>No</button>
        </div>
        <a href="#" class="feedback-link">Provide product feedback</a>
        
        <!-- Cache management (for development) -->
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
          <small style="color: #666;">Development tools:</small><br>
          <button onclick="clearAdaptationCache()" style="font-size: 12px; padding: 4px 8px; margin-top: 5px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">
            Clear Content Cache
          </button>
          <span id="cache-status" style="margin-left: 10px; font-size: 12px; color: #666;"></span>
        </div>
      </section>
    </main>
    <aside class="right-nav">
      <div class="in-this-article">
        <h4>In this article</h4>
        <ul>
          {% if in_this_article %}
          {% for item in in_this_article %}
          <li><a href="{{ item.anchor }}">{{ item.title }}</a></li>
          {% endfor %}
          {% endif %}
        </ul>
      </div>
    </aside>
  </div>
  <footer>
    <div class="footer-links">
      <a href="#">English (United States)</a>
      <span class="privacy-choice">Your Privacy Choices</span>
      <span class="theme-select">Theme</span>
    </div>
    <div class="footer-links">
      <a href="#">Previous Versions</a>
      <a href="#">Blog</a>
      <a href="#">Contribute</a>
      <a href="#">Privacy</a>
      <a href="#">Terms of Use</a>
      <a href="#">Trademarks</a>
      <span>¬© Microsoft 2025</span>
    </div>
  </footer>
  <script>
    // Interactive 3-spot slider with proper alignment - works with multiple sliders
    (function () {
      // Store original content for each section
      const originalContent = {};
      
      // Function to initialize a single slider
      function initSlider(sliderId) {
        const slider = document.getElementById(sliderId);
        if (!slider) return; // Skip if slider doesn't exist
        
        const sectionId = sliderId.replace('slider-', '');
        const section = document.getElementById(sectionId);
        
        // Store original content when initializing
        if (section && !originalContent[sectionId]) {
          const content = section.querySelector('.section-content');
          if (content) {
            originalContent[sectionId] = content.innerHTML;
          }
        }
        
        const thumb = slider.querySelector('.slider-thumb');
        const dots = slider.querySelectorAll('.slider-dot');
        let pos = 2; // Start at advanced position (right)

        // These percentages align the center of the thumb with the center of the dots
        const positions = [0, 0.5, 1];

        function setSlider(position) {
          // Mark that user has interacted with this slider
          slider.setAttribute('data-user-interacted', 'true');
          
          pos = position;
          // Calculate left as a percentage of track width
          // Since thumb uses transform: translate(-50%, -50%), this will center the thumb on the dot
          const percent = positions[pos] * 100 + "%";
          thumb.style.left = percent;
          dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === pos);
          });
          slider.setAttribute('aria-valuenow', pos + 1);
          
          // Send slider state to Flask
          sendSliderState(sliderId, position);
        }
        
        function sendSliderState(sliderId, position) {
          const sectionId = sliderId.replace('slider-', '');
          
          // Don't send updates for advanced position during initialization
          // Only send when user actually interacts with slider
          if (position === 2 && !slider.hasAttribute('data-user-interacted')) {
            return;
          }
          
          // Update slider state
          fetch('/slider-update', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              slider_id: sliderId,
              position: position,
              section_id: sectionId
            })
          })
          .then(response => response.json())
          .then(data => {
            console.log('Slider state updated:', data);
            
            // Only adapt content if not at advanced level (position 2)
            if (position !== 2) {
              adaptSectionContent(sectionId, position);
            } else {
              // Reset to original content for advanced level
              resetSectionContent(sectionId);
            }
          })
          .catch(error => {
            console.error('Error updating slider state:', error);
          });
        }
        
        function adaptSectionContent(sectionId, level) {
          // Show loading indicator
          showLoadingIndicator(sectionId);
          
          // Get current filename from URL
          const pathParts = window.location.pathname.split('/');
          const filename = pathParts[pathParts.length - 1] || 'overview.md';
          
          fetch('/adapt-content', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              section_id: sectionId,
              level: level,
              filename: filename.endsWith('.md') ? filename : filename + '.md'
            })
          })
          .then(response => response.json())
          .then(data => {
            hideLoadingIndicator(sectionId);
            
            if (data.status === 'success') {
              updateSectionContent(sectionId, data.adapted_content);
            } else {
              console.error('Error adapting content:', data.error);
              showErrorMessage(sectionId, 'Failed to adapt content. Please try again.');
            }
          })
          .catch(error => {
            hideLoadingIndicator(sectionId);
            console.error('Error adapting content:', error);
            showErrorMessage(sectionId, 'Failed to adapt content. Please try again.');
          });
        }
        
        function resetSectionContent(sectionId) {
          // Restore original content from stored HTML
          if (originalContent[sectionId]) {
            const section = document.getElementById(sectionId);
            if (section) {
              const content = section.querySelector('.section-content');
              if (content) {
                content.innerHTML = originalContent[sectionId];
                content.style.opacity = '1';
                content.style.pointerEvents = 'auto';
              }
            }
            console.log(`Reset section ${sectionId} to advanced level (original content)`);
          }
        }
        
        function showLoadingIndicator(sectionId) {
          const section = document.getElementById(sectionId);
          if (section) {
            const content = section.querySelector('.section-content');
            if (content) {
              content.style.opacity = '0.5';
              content.style.pointerEvents = 'none';
              
              // Add loading spinner
              const spinner = document.createElement('div');
              spinner.className = 'loading-spinner';
              spinner.innerHTML = 'üîÑ Adapting content...';
              spinner.style.cssText = 'text-align: center; padding: 20px; font-style: italic; color: #666;';
              content.appendChild(spinner);
            }
          }
        }
        
        function hideLoadingIndicator(sectionId) {
          const section = document.getElementById(sectionId);
          if (section) {
            const content = section.querySelector('.section-content');
            if (content) {
              content.style.opacity = '1';
              content.style.pointerEvents = 'auto';
              
              // Remove loading spinner
              const spinner = content.querySelector('.loading-spinner');
              if (spinner) {
                spinner.remove();
              }
            }
          }
        }
        
        function updateSectionContent(sectionId, adaptedContent) {
          const section = document.getElementById(sectionId);
          if (!section) return;
          
          const content = section.querySelector('.section-content');
          if (!content) return;
          
          // Clear existing content
          content.innerHTML = '';
          
          // Add adapted content while preserving structure
          adaptedContent.forEach(item => {
            const element = document.createElement('div');
            
            switch (item.type) {
              case 'paragraph':
                element.className = 'para';
                element.innerHTML = item.text;
                break;
              case 'note':
                element.className = 'note-block';
                element.innerHTML = item.text;
                break;
              case 'list':
                const list = document.createElement('ul');
                item.elements.forEach(listItem => {
                  const li = document.createElement('li');
                  li.innerHTML = listItem;
                  list.appendChild(li);
                });
                element.appendChild(list);
                break;
              case 'video':
                element.className = 'video-container';
                element.innerHTML = item.html || '';
                break;
              case 'zone-pivot':
                element.className = 'zone-pivot-container';
                element.setAttribute('data-pivot', item.pivot || '');
                element.innerHTML = item.html || '';
                break;
              default:
                element.innerHTML = item.text || '';
            }
            
            content.appendChild(element);
          });
          
          // Re-initialize any interactive elements if needed
          // (e.g., code syntax highlighting, zone pivots)
          initializeInteractiveElements(content);
        }
        
        function initializeInteractiveElements(container) {
          // This function can be used to reinitialize any interactive elements
          // after content has been dynamically updated
          // For now, it's just a placeholder that does nothing
          // You could add code here to reinitialize syntax highlighting, tooltips, etc.
        }
        
        function showErrorMessage(sectionId, message) {
          const section = document.getElementById(sectionId);
          if (section) {
            const content = section.querySelector('.section-content');
            if (content) {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'error-message';
              errorDiv.style.cssText = 'background: #ffebee; border: 1px solid #f44336; color: #c62828; padding: 10px; margin: 10px 0; border-radius: 4px;';
              errorDiv.textContent = message;
              content.appendChild(errorDiv);
            }
          }
        }

        function getClosestSliderPos(event) {
          const rect = slider.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const width = rect.width;
          if (x < width / 4) return 0;
          if (x > width * 3 / 4) return 2;
          return 1;
        }

        // Mouse click on slider
        slider.addEventListener('click', function (e) {
          if (e.target.classList.contains('slider-thumb')) return;
          const pos = getClosestSliderPos(e);
          setSlider(pos);
        });

        // Thumb drag
        let dragging = false;
        thumb.addEventListener('mousedown', function (e) {
          dragging = true;
          document.body.style.userSelect = "none";
          e.preventDefault();
        });
        document.addEventListener('mousemove', function (e) {
          if (!dragging) return;
          const sliderRect = slider.getBoundingClientRect();
          const x = e.clientX - sliderRect.left;
          const width = sliderRect.width;
          let pos;
          if (x < width / 4) pos = 0;
          else if (x > width * 3 / 4) pos = 2;
          else pos = 1;
          setSlider(pos);
        });
        document.addEventListener('mouseup', function () {
          if (dragging) {
            dragging = false;
            document.body.style.userSelect = "";
          }
        });

        // Keyboard navigation
        slider.addEventListener('keydown', function (e) {
          if (e.key === "ArrowRight" || e.key === "ArrowUp") {
            if (pos < 2) setSlider(pos + 1);
            e.preventDefault();
          } else if (e.key === "ArrowLeft" || e.key === "ArrowDown") {
            if (pos > 0) setSlider(pos - 1);
            e.preventDefault();
          }
        });

        // Set initial position (advanced level, no API call needed)
        pos = 2;
        const percent = positions[pos] * 100 + "%";
        thumb.style.left = percent;
        dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === pos);
        });
        slider.setAttribute('aria-valuenow', pos + 1);
      }

      // Initialize all sliders on the page
      document.addEventListener('DOMContentLoaded', function() {
        const sliders = document.querySelectorAll('.switch-slider');
        sliders.forEach(slider => {
          initSlider(slider.id);
        });
      });
    })();

    // Cache management functions
    function clearAdaptationCache() {
      fetch('/clear-cache', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        const statusElement = document.getElementById('cache-status');
        if (data.status === 'success') {
          statusElement.textContent = `‚úÖ Cleared ${data.cache_size} items`;
          statusElement.style.color = '#28a745';
          
          // Clear the status message after 3 seconds
          setTimeout(() => {
            statusElement.textContent = '';
          }, 3000);
        } else {
          statusElement.textContent = '‚ùå Failed to clear cache';
          statusElement.style.color = '#dc3545';
        }
      })
      .catch(error => {
        console.error('Error clearing cache:', error);
        const statusElement = document.getElementById('cache-status');
        statusElement.textContent = '‚ùå Error clearing cache';
        statusElement.style.color = '#dc3545';
      });
    }

    // Zone Pivot Management
    (function() {
      let currentPivot = 'os-windows'; // Default to Windows for install instructions
      
      function createPivotSelector() {
        // Find all zone pivots and collect unique pivot values
        const zonePivots = document.querySelectorAll('.zone-pivot[data-pivot]');
        const pivots = new Set();
        
        zonePivots.forEach(zone => {
          const pivot = zone.getAttribute('data-pivot');
          if (pivot) {
            pivots.add(pivot);
          }
        });
        
        if (pivots.size <= 1) return; // No need for selector if only one pivot
        
        // Create pivot selector for each section that has zone pivots
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
          const sectionZones = section.querySelectorAll('.zone-pivot[data-pivot]');
          if (sectionZones.length === 0) return;
          
          const sectionPivots = new Set();
          sectionZones.forEach(zone => {
            const pivot = zone.getAttribute('data-pivot');
            if (pivot) {
              sectionPivots.add(pivot);
            }
          });
          
          if (sectionPivots.size <= 1) return;
          
          // Create selector
          const selector = document.createElement('div');
          selector.className = 'zone-pivot-selector';
          
          const pivotNames = {
            'os-windows': 'Windows',
            'os-linux': 'Linux', 
            'os-macos': 'macOS',
            'programming-language-nodejs': 'Node.js',
            'programming-language-python': 'Python',
            'programming-language-csharp': 'C#',
            'programming-language-javascript': 'JavaScript',
            'programming-language-typescript': 'TypeScript'
          };
          
          sectionPivots.forEach(pivot => {
            const button = document.createElement('button');
            button.textContent = pivotNames[pivot] || pivot.charAt(0).toUpperCase() + pivot.slice(1);
            button.setAttribute('data-pivot', pivot);
            button.addEventListener('click', () => switchPivot(pivot));
            
            if (pivot === currentPivot) {
              button.classList.add('active');
            }
            
            selector.appendChild(button);
          });
          
          // Insert selector before the first zone pivot in this section
          const firstZone = section.querySelector('.zone-pivot[data-pivot]');
          if (firstZone) {
            firstZone.parentNode.insertBefore(selector, firstZone);
          }
        });
      }
      
      function switchPivot(pivot) {
        currentPivot = pivot;
        
        // Update all zone pivots
        const allZones = document.querySelectorAll('.zone-pivot[data-pivot]');
        allZones.forEach(zone => {
          const zonePivot = zone.getAttribute('data-pivot');
          if (zonePivot === pivot) {
            zone.classList.add('active');
          } else {
            zone.classList.remove('active');
          }
        });
        
        // Update selector buttons
        const allButtons = document.querySelectorAll('.zone-pivot-selector button');
        allButtons.forEach(button => {
          const buttonPivot = button.getAttribute('data-pivot');
          if (buttonPivot === pivot) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
        });
        
        // Update URL without reload
        const url = new URL(window.location);
        if (pivot.startsWith('programming-language-')) {
          const lang = pivot.replace('programming-language-', '');
          url.searchParams.set('lang', lang);
        } else if (pivot.startsWith('os-')) {
          const os = pivot.replace('os-', '');
          url.searchParams.set('os', os);
        }
        window.history.replaceState({}, '', url);
      }
      
      function initializePivots() {
        // Check URL parameters for initial pivot
        const urlParams = new URLSearchParams(window.location.search);
        const langParam = urlParams.get('lang');
        const osParam = urlParams.get('os');
        
        if (langParam) {
          currentPivot = `programming-language-${langParam}`;
        } else if (osParam) {
          currentPivot = `os-${osParam}`;
        }
        
        // Show zones for current pivot
        switchPivot(currentPivot);
        
        // Create pivot selectors
        createPivotSelector();
      }
      
      // Initialize when DOM is ready
      document.addEventListener('DOMContentLoaded', initializePivots);
    })();
    
    // Cache management functions
    function clearAdaptationCache() {
      fetch('/clear-cache', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        const statusElement = document.getElementById('cache-status');
        if (data.status === 'success') {
          statusElement.textContent = `‚úÖ Cleared ${data.cache_size} items`;
          statusElement.style.color = '#28a745';
          
          // Clear the status message after 3 seconds
          setTimeout(() => {
            statusElement.textContent = '';
          }, 3000);
        } else {
          statusElement.textContent = '‚ùå Failed to clear cache';
          statusElement.style.color = '#dc3545';
        }
      })
      .catch(error => {
        console.error('Error clearing cache:', error);
        const statusElement = document.getElementById('cache-status');
        statusElement.textContent = '‚ùå Error clearing cache';
        statusElement.style.color = '#dc3545';
      });
    }
  </script>
</body>

</html>